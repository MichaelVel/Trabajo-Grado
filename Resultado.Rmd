---
title: "Resultados"
author: "Michael Velandia"
date: "17/05/2021"
output: 
  html_document: default
  pdf_document: default
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
source("Code/eda.R")
```

## Resultados 

Los resultados 

```{r summary, echo=FALSE,  message=FALSE, warning=FALSE }

summary_data <- (function () {
    summary_data <- summary_statistics()
    mean <-  summary_data$mean %>% 
             column_to_rownames("Estacion") %>%
             round(digits = 2)
    sd <-  summary_data$sd %>% 
             column_to_rownames("Estacion") %>%
             round(digits = 2)
    data <- list(Estacion = summary_data$mean[["Estacion"]])
    
    for (i in 1:5){
        a <- paste0( mean[[i]], 'Â±', sd[[i]]) 
        data[[1+i]] <- a
    }
    
    data <- as.data.frame(data)
    names(data) <-  names(summary_data$mean)
    data <- left_join(data, summary_data$macroinvertebrates, by = "Estacion")
    names(data) <- gsub("_", " ", names(data))
    
    return(data)
})()

doc.type <- knitr::opts_knit$get('rmarkdown.pandoc.to')

if (doc.type == "docx") {
    
  summary_data %>%
      flextable() %>%
      set_caption( caption = "New York Air Quality Measurements") %>% ## Change caption and footer
      add_footer_lines(values = "Daily air quality measurements in New Y")

} else {
    
  summary_data %>%
      kbl(booktabs = TRUE, escape = FALSE, caption = " Categorias de los Rasgos Funcionales") %>%
      collapse_rows(columns = 1, valign = "middle", latex_hline = "major") %>% 
      kable_styling(full_width = FALSE)
}
```

```{r eda,  message=FALSE, warning=FALSE, cache= FALSE, echo=FALSE, fig.height= 6, fig.width= 9, fig.align='center'}
plot_pca <- make_pca(type = 'hidrologicos', plot_type = "Tipo_Estacion")
plot_cluster <-  make_cluster()
layout <- "
AAAAAAACCCC
AAAAAAABBBB
AAAAAAABBBB
AAAAAAABBBB
"
plot_pca$biplot + 
  plot_cluster$dendogram + 
  plot_pca$eigenvalues + 
  plot_layout(design = layout, guides = 'collect') +
  guide_area() +
  plot_annotation(tag_levels = 'A') 
  

```

```{r rlq ,  message=FALSE, warning=FALSE, cache= FALSE, echo=FALSE, fig.height= 9, fig.width= 10}
rlq1 <- make_rlq()
plot(rlq1)
```

## Anexos 

### Analisis univarido

En las figuras ?-1 al ?-10 se observan los diagramas de caja y los graficos
cuantil-cuantil que corresponden a un analisis exploratorio de las variables 
fisicoquimicas.   
```{r anexos_eda, message=FALSE, warning=FALSE, cache=TRUE,include = TRUE, echo = FALSE, fig.height= 9, fig.width= 6, fig.align='center'}
qq_plots <- univariate_graphical_eda(type_plot = 'quantile-normal')
box_plots <-  univariate_graphical_eda(type_plot = 'boxplot')


  qq_plots$Ox_disuelto + 
  qq_plots$Turbidez +
  qq_plots$pH +
  box_plots$Ox_disuelto + 
  box_plots$Turbidez +
  box_plots$pH +
  plot_layout(ncol = 2, byrow = FALSE ) 
  
```

```{r, , message=FALSE, warning=FALSE, cache=TRUE,include = TRUE, echo = FALSE, fig.height= 6, fig.width= 6, fig.align='center'}
qq_plots <- univariate_graphical_eda(type_plot = 'quantile-normal')
box_plots <-  univariate_graphical_eda(type_plot = 'boxplot')

qq_plots$Conductividad + 
  qq_plots$Temperatura +
    box_plots$Conductividad + 
  box_plots$Temperatura +
  plot_layout(ncol = 2, byrow = FALSE )

```

```{r}
 make_manova()
print(summary(make_manova(rio = 'Rio Frio')))
print(summary(make_manova(rio = 'Rio Neusa1')))
print(summary(make_manova(rio = 'Rio Neusa2')))
```

