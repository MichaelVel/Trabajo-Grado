---
title: "Selección de Rasgos Funcionales de las comunidades de macroinvertebrados para su uso como varibles indicadoras de calidad en dos ríos de la sabana de Bogotá"
author: "Michael Sebastián Velandia Garavito"
date: "26/05/2021"
header-includes:
- \usepackage{pdflscape}
- \newcommand{\blandscape}{\begin{landscape}}
- \newcommand{\elandscape}{\end{landscape}}
output:
  pdf_document: default
  html_document: default
  word_document: default
always_allow_html: true
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = FALSE, message=FALSE, warning=FALSE)

source("../Code/metodos.R")
source("../Code/eda.R")
source("../Code/biological_index_COL.R")


## Load RLQ Data

RTable <- "../Data/rlq/RTable.csv"
LTable <- "../Data/rlq/LTable.csv"
QTable <- "../Data/rlq/QTable.csv"

RLQ <- load_rlq(RTable, LTable ,QTable)

parameters <- c("Temperatura", "OxDisuelto", "pH", 
                "Conductividad", "Turbidez") 

## Load Complete Data

complete <- read.csv("../Data/muestreo_completo.csv",
                     stringsAsFactors = FALSE)


```

## Introducción

Las condiciones ambientales de una gran cantidad de ríos en las áreas tropicales
se ha ido deteriorando a raíz del  rápido crecimiento de las poblaciones humanas,
los cambios en el uso del suelo, el desarrollo agrícola e industrial, y las
actividades extractivas (Dudgeon, 2017). Desde los años 90 se ha venido implementando
el monitoreo con índices que integran las variables fisicoquímicas para la medición 
de la calidad de las aguas de los ríos y su integridad, y más recientemente, se 
han incorporado los índices bióticos que utilizan una variedad de grupos taxonómicos, 
entre ellos, los macroinvertebrados (Pinilla, 2010). Las experiencias en países
templados (Fierro, 2017; Metcalfe, 1989) han demostrado que el uso de los 
macroinvertebrados para el biomonitoreo presenta ventajas sobre los índices 
físico químicos, pues integran información de cambios al corto y el largo plazo
en un amplio rango de variables ambientales (Dudgeon, 2017; Fierro *et al*., 2017).  

El uso de macroinvertebrados para el biomonitoreo de la calidad de agua ha 
estado tradicionalmente enmarcado en un enfoque taxonómico que se basa en
la tolerancia de ciertos taxones a la polución. Sin embargo, uno de los mayores
limitantes para esta aproximación es la dificultad de hacer una determinación
de los organismos de manera rápida y a un suficiente nivel de detalle (género
o especie) para usarlos en programas de monitoreo(Cummins *et al*., 2005). 

Desde hace algunas décadas, el estudio de los rasgos funcionales de las especies 
de sistemas lóticos ha demostrado una gran utilidad como un buen indicador de la 
respuesta de las comunidades a diversos tipos de disturbios, entre  los que se 
encuentran los de naturaleza antrópica (Ding *et al*., 2017), y en consecuencia 
se ha ido desarrollando un enfoque funcional para el biomonitoreo de sistemas 
lóticos, principalmente en zonas templadas, con algunos ejemplos en el  Neotrópico
(Tomanova *et al*., 2008).

Gran parte de los estudios que se han realizado sobre el uso de la diversidad 
y los rasgos funcionales en bioindicación se han ejecutado en países de zonas
templadas (Charvet *et al*., 1998; Gayraud *et al*., 2003; Statzner *et al*., 2005;
Dolédec *et al*.,2006), siendo mucho menor la cantidad de trabajos llevados a 
cabo en el trópico (Ding *et al*., 2017). Una alta proporción de las 
investigaciones en el Neotrópico sobre este tema se han hecho en Brasil, con
algunos otros ejemplos en países como Ecuador o Bolivia (Fossati *et al*., 2001;
Cummins *et al*., 2005; Tomanova *et al*., 2008). En Colombia se han realizado 
algunos acercamientos sobre aspectos funcionales de los macroinvertebrados en
la región insular (Motta Díaz *et al*., 2020), en Antioquia (Toro *et al*., 2020)
y en Boyacá (Torres-Zambrano y Torres-Zambrano, 2016), pero en ninguno de ellos 
se ha buscado identificar los rasgos más apropiados para la construcción de 
índices biológicos.

Un primer paso para el desarrollo de un índice biológico de macroinvertebrados con un 
enfoque funcional en los ríos de la sabana de Bogotá, es la evaluación de los 
rasgos funcionales de las comunidades de dichos macroinvertebrados con el fin de
evaluar cual es su respuesta a los parámetros fisicoquímicos de estos cuerpos de 
agua. En el presente trabajo se busca evaluar dicha respuesta  y hacer una 
comparación con las mediciones obtenidas por  los tradicionales indices biológicos. 


## Metodología  

### Área de estudio y muestreo 

Los macroinvertebrados utilizados provienen de una serie de muestreos realizados
entre el año 2017 y el año 2019 en 11 estaciones de muestreo ubicadas en los ríos
Frío y Neusa, en los municipios de Cajicá, Chía y Cogua (Figura 1), en el
marco del “Programa nacional para la conservación de la especie endémica de
Colombia pez capitán de la sabana (*Eremophilus mutisii*)” liderado por el Ministerio del
Medio Ambiente y la Universidad Manuela Beltrán (Lemus-Portillo *et al*., 2020). En cada
punto de muestreo se tomaron datos hidrológicos y se midieron *in situ*
las variables fisicoquímicas oxígeno disuelto, conductividad, pH, temperatura
y turbidez. Los macroinvertebrados se colectaron con metodologías estándar de
amplio  reconocimiento, red Surber, red D, red de mano (Domínguez y Fernández, 2009). 

```{r sampling estation, message=FALSE, warning=FALSE, cache=TRUE, fig.height= 5, fig.width= 7, fig.align='center', echo=FALSE, fig.cap= " Estaciones de muestreo en los rios Neusa (derecha)y Frio (izquierda)."}

estaciones <- read.csv("../Data/other/estaciones.csv")
plot_est(estaciones)
```

### Rasgos Funcionales 

Los organismos, pertenecientes a la colección de  macroinvertebrados de la
Universidad Manuela Beltrán, fueron identificados hasta Familia.  Los rasgos
funcionales que fueron elegidos de acuerdo a la propuesta de Tomanova *et al*. (2008)
incluyen rasgos tróficos (alimentación y hábitos alimenticios), fisiológicos
(respiración) morfológicos (tamaño y forma corporal) y comportamentales (Movilidad
y fijación al sustrato). Siguiendo la metodología del 'Fuzzy coding'  
(Usseglio‐Polatera, 1994) a cada familia se le asignó un valor entre 0 y 3 para 
cada una de las categorías de los rasgos funcionales (Tabla 1) por medio de 
observaciones y mediciones directas en el laboratorio, apoyadas en una revisión 
de la literatura disponible. 


```{r table_funct, echo=FALSE}

data  <- read.csv("../Data/other/rasgos_funcionales_tabla.csv", 
                  check.names = FALSE)
doc.type <- knitr::opts_knit$get('rmarkdown.pandoc.to')

  data %>%
    kbl(booktabs = TRUE, escape = FALSE, caption = "
        Categorias de los Rasgos Funcionales. Tomado y modificado de 
        Tomanova et al. (2008) ") %>%
    collapse_rows(columns = 1, valign = "middle", latex_hline = "major") %>% 
    kable_styling(full_width = FALSE)


```

### Métodos numéricos y estadísticos

Con el fin de establecer el gradiente ambiental, se realizó un análisis de cluster
y un análisis de componentes principales (PCA), para establecer diferencias entre
las condiciones fisicoquímicas de las estaciones se realizó un análisis de
varianza multivariado (MANOVA). La evaluación de la respuesta de los rasgos
funcionales al gradiente ambiental se realizó con un análisis de coinercia RLQ,
que vincula las matrices de variables ambientales *R* y rasgos funcionales *Q* por
medio de una matriz de abundancia *L* (Dolédec *et al*.,2006). Para probar las
asociaciones individuales de cada rasgo funcional con las variables ambientales
se realizó un análisis *fourth corner* (Dray y Legendre, 2008). Todos los análisis
fueron realizados en el software R versión 3.6.3 (R Core Team, 2020), utilizando
el paquete ade4 (Dray, 2007).


## Resultados

### Evaluación gradiente ambiental 

Las características medioambientales de las estaciones evaluadas se encuentran
resumidas en la tabla 2. Los resultados del análisis  de cluster muestran que
las estaciones evaluadas se pueden clasificar en cuatro grupos diferentes (Fig 2B),
que muestra una clara diferencia entre las estaciones del río Frío y las estaciones
del río Frío. En el río Frío se observa que las estaciones ubicadas en la vereda Canelon
de Cajicá forman un grupo (FrioB) y la estación ubicada en la zona urbana de Chía
forma el otro (FrioA). En el río Neusa se observa una diferencia de las estaciones
en las condiciones físico químicas antes del embalse del Neusa (NeusaA) y después
(NeusaB). Los resultados del MANOVA y del análisis post hoc entre estos cuatro grupos
indica que existen diferencias significativas entre ellos (Anexo 3).  

Las características hidrologicas de los ríos no varían en gran medida entre las
estaciones (Tabla 2 y Anexo 2) y por lo tanto aportan poco al gradiente ambiental, 
por lo que fueron excluidas de los análisis posteriores.  

```{r summary, echo=FALSE,  message=FALSE, warning=FALSE, fig.height= 6, fig.width= 11, fig.align='center' }

summary_data <- (function () {
    summary_data <- summary_statistics(data = complete)
    mean <-  summary_data$mean %>% 
             column_to_rownames("Estacion") %>%
             round(digits = 2)
    sd <-  summary_data$sd %>% 
             column_to_rownames("Estacion") %>%
             round(digits = 2)
    data <- list(Estacion = summary_data$mean[["Estacion"]])
    
    names <- c("Estacion", "Temperatura (C°)", "Ox disuelto (mg/L)", "pH",
             "Conductividad (µS/cm)", "Turbidez (NTU)", 
             "Profundidad (cm)", "Velocidad (m/s)",
             "Altitud (msnm)","Familias", "Total Macro")
    
    for (i in 1:7){
        a <- paste0( mean[[i]], '±', sd[[i]]) 
        data[[1+i]] <- a
    }
    
    data <- as.data.frame(data)
    names(data) <-  names(summary_data$mean[1:8])
    data <- cbind(data,summary_data$mean[["Altitud"]])
    data <- left_join(data, summary_data$macroinvertebrates, by = "Estacion")
    names(data) <- names
    
    data <- data %>%
      column_to_rownames("Estacion") %>%
      as.matrix(data) %>%
      t() %>%
      as.data.frame()

    
    return(data)
})()


  summary_data %>%
      kbl(booktabs = TRUE, escape = FALSE, 
          caption = "Condiciones ambientales de los rios Neusa y Frio
                     en las estaciones trabajadas ") %>% 
      kable_styling(latex_options="scale_down")
    

```

Los resultados del PCA muestran que el 70% de la varianza de las variables 
fisicoquimicas se concentra en los dos primeros componentes (Fig 2C). El primer
componente esta explicado principalmente por el oxigeno disuelto, la 
turbidez y la temperatura de las aguas y es por tanto el eje más relevante en 
la evaluación del gradiente ambiental de las estaciones evaluadas. En el gráfico
del PCA (Fig 2A) se puede observar un gradiente de derecha a izquierda en el que
se acidifica el agua, se disminuye el oxigeno disuelto y aumenta la turbidez de 
las aguas.  Si bien también se observa un gradiente de temperatura, este no 
necesariamente esta relacionado con el gradiente ambiental, sino que se debe a 
las diferencias de altura entre estaciones (Tabla 2).  

Las mediciones de pH realizadas en el río Frio muestran una  alta variabilidad
entre los muestreos que contrasta con las mediciones del río Neusa que en general
son más homogéneas y presentan un pH neutro. La conductividad también presenta 
un comportamiento diferencial entre los ríos. En el caso del río Neusa, las 
estaciones anteriores a la represa (Neusa A) presentan valores más elevados que
los presentes en las estaciones posteriores a la represa (Neusa B), sin embargo 
cabe resaltar que en las estaciones del grupo Neusa A, la varibilidad  entre 
muestreos es mucho más elevada (Anexo 2) que en el resto de estaciones,  razón 
por la cual esta alta conductividad podría deberse a razones puntuales en
los periodos de muestreo.  En el río Frio el gradiente de conductividad es el 
esperado, sin muchas diferencias entre las estaciones río arriba (Frio B) y una 
alta conductividad en la estación Frio5. 


```{r eda,  message=FALSE, warning=FALSE, cache= FALSE, echo=FALSE, fig.height= 6, fig.width= 9, fig.align='center', fig.cap= " Analisis de Componentes Principales y Analisis Jerarquico de Cluster. A) Proyección de las variables fisicoquimicas en el plano del ACP. B) Dendrogama de las estaciones. Se utilizo como la distancia euclidia como metrica de similitud y se computo utilizando el algoritmo UPGMA C) Varianza explicada por los componentes del ACP. "}


plot_pca <- make_pca(RLQ$R_table, plot_type = "Tipo_Estacion", 
                     parameters = parameters )

pca <- make_pca(RLQ$R_table, plot = FALSE)

group <- factor(RLQ[["R_table"]]$Estacion)

estations <- cbind(Grupo = group, as.data.frame(pca$x))

mean_estations <- estations %>% 
    group_by(Grupo) %>%
    summarise(across(.cols = everything() , mean))

plot_pca2 <- plot_pca$biplot + 
  geom_text_repel(data= mean_estations, mapping = aes(PC1, PC2, label = Grupo), size =3.5 )

plot_cluster <-  make_cluster(RLQ$R_table, parameters = parameters)

dendogram <- fviz_dend(plot_cluster,  main = "", palette = 'futurama', k = 4) 

layout <- "
AAAAAAACCCC
AAAAAAABBBB
AAAAAAABBBB
AAAAAAABBBB
"
plot_pca2 + 
  dendogram + 
  plot_pca$eigenvalues + 
  plot_layout(design = layout, guides = 'collect') +
  guide_area() +
  plot_annotation(tag_levels = 'A') 
  


custom_palette <- c("#FF6F00FF", "#C71000FF", "#008EA0FF", "#8A4198FF")

```

### Indices bioticos 

#### Diversidad 

La diversidad alfa de las estaciones muestreadas es similar en ambos 
rios, y en general no muestra relación con el gradiente ambiental 
establecido (Figura 3 B). Salvo la estación Fri5, que presenta  una
baja  riqueza de familias , las estaciones del rio frio presentan valores
similares tanto en la riqueza de familias  como en  los indices de 
diversidad alfa, que cuenta con una alta presencia de gastropodos y de 
anfípodos de la familia Hyallelidae (Tabla 3).

El rio neusa tambien presenta una diversidad alfa similar entre sus 
estaciones, salvo por la estación Neu7 que presenta una mayor riqueza de 
familias, asi como valores más altos de los indices de diversidad. Sin 
embargo, la estructura de las comunidades del rio neusa difiere en gran 
medida de las estaciones del rio frio, puesto que presenta una alta 
presencia de dipteros (familias Chironomidae, Tipullidae y Simullidae) y 
una escasa presencia de gastropodos y de anfípodos (Tabla 3). 

El analisis de la diversidad beta muestra una diferenciación entre las 
estaciones de ambos ríos, salvo por la estación Fri5 que presenta una 
composición similar a la encontrada en las estaciones del rio neusa (Fig 3 A). 
Sin embargo, al ver los clusteres que forman estos ríos no se ve un 
patrón consistente con el gradiente ambiental observado (Fig 2A). 

#### Bioindicadores

Los valores del indice BMWP/Col, salvo las estaciones Neu1 y Fri5 que presentan 
valores muy bajos, muestran valores  relativamente altos que indican aguas aceptables
con un ligero nivel de contaminación. Esto es poco consistentes tanto con el ASPT como
con el indice de hillsenhoff, puesto que estos indice muestran que la calidad de las 
aguas en ambos rios es de dudosa calidad, con algunas estaciones presentando un estado 
critico (Fig 3 B). Los valores de estos indices son en general inconsistentes 
con el patron ambiental observado y con los grupos generados por el analisis 
de cluster de las variables ambientales (Fig 2 A y Fig 2 B).


```{r biological_index, include= FALSE}

data <- read.csv("../Data/rlq/LTable.csv") %>% 
    select(-c(Muestra)) %>%
    group_by(Estacion) %>%
    summarise(across(everything(), mean)) %>%
    column_to_rownames("Estacion") %>%
    as.matrix() %>%
    t() 

data <- read.csv("../Data/rlq/LTable.csv") %>% 
    unite(Names, Estacion, Muestra) %>%
    column_to_rownames("Names") %>%
    as.matrix() %>%
    t()    

 index_table <- data.frame( 'BMWP COL' = bmwp_COL(data)$bmwp_scores,
            'ASPT' = bmwp_COL(data, ASPT = TRUE),
            'FBI'  = hillsenhoff_index(data)$hillsenhoff_scores,
            check.names = FALSE)


```


```{r diversity, include=FALSE}

data <- RLQ$L_table %>% 
    select(-Muestra, -Tipo_Estacion) %>%
    group_by(Estacion) %>%
    summarise(across(everything(), mean)) %>%
    column_to_rownames("Estacion") 

data2 <- complete %>% 
  group_by(Estacion, Muestra) %>% 
  summarise( Familias = n_distinct(Familia),
             Total_Macro = sum(Individuos)) %>%
  select(-Muestra ) %>%
  group_by(Estacion) %>% 
  summarise(across(everything(), mean)) 

diversity_table <- data.frame(
                         'H' = diversity(data, index = 'shannon'),
                         '1-D' = diversity(data, index = 'invsimpson'),
                         'n' = round(data2$Total_Macro, 0), 
                         'k' = round(data2$Familias, 0),
                          check.names = FALSE) %>%
                    round(digits = 2) 

data_discussion <- data[c("Chironomidae", "Simuliidae", "Hyalellidae",
                          "Physidae", "Sphaeriidae", "Naididae" )]# to discussion
data_discussion2 <- RLQ$Q_table[c("Chironomidae", "Simuliidae", "Hyalellidae",
                          "Physidae", "Sphaeriidae", "Naididae" ),] %>%
  t() %>% 
  as.data.frame()
# Working in beta diversity

distance_matrix <- read.csv("../Data/other/abundancia_orden.csv") %>% 
                   select(-Muestra) %>%
                   group_by(Estacion) %>%
                   summarise(across(.cols = everything() , mean)) %>%
                   ungroup() %>%
                   column_to_rownames(var = 'Estacion') %>%
                   vegdist(method="bray", binary= FALSE ) 
    

    cluster <-  hclust(distance_matrix, method = "average")
    
    dendogram <- fviz_dend(cluster, k = 1, main = "", palette = 'black')
    
```


```{r div_index_plotm,fig.height= 6, fig.width= 10, fig.align='center', fig.cap= "Diversidad e indices biologicos de las estaciones muestreadas. A) Diversidad beta. Dendograma de las estaciones basado en el indice Bray-Curtis y computado con el algoritmo UPGMA. B) Tabla de indices de diversidad alfa e indicadores biologicos. H = indice de Shannon-Weaver, 1-D = indice de diversidad de Simpson, n = promedio de individuos por muestreo, k = promedio de familias por muestreo. " }

layout <- c(
  area(t = 1, l = 1, b = 4, r = 3),
  area(t = 1, l = 3, b = 2, r = 4)
)

div_indx <- cbind(diversity_table, index_table) %>%
            tableGrob(theme = ttheme_default(base_size = 10)) %>%
            gtable::gtable_add_cols(unit(0.025, "npc"), 5) %>%
            gtable::gtable_add_cols(unit(0.0125, "npc"), 1)


dendogram + 
  div_indx+
  plot_layout(design = layout, guides = 'collect') +
  plot_annotation(tag_levels = 'A') 
```


```{r ab_table, fig.height= 3, fig.width= 6, fig.align='center'}
data <- read.csv("../Data/other/abundancia_orden.csv") %>% 
    select(-Muestra)

abundance_table <- abundance_metrics(data) %>%
    rownames_to_column() %>%
    mutate(EPT = Ephemeroptera + Trichoptera,
           Turbellaria = Tricladida) %>%
    column_to_rownames() %>%
    select(EPT, Diptera, Amphipoda, Bivalvia, Gastropoda, 
           Hemiptera, Hirudinea, Turbellaria, Oligochaeta) %>%
    round(digits = 2)

abundance_table %>%
  kbl(booktabs = TRUE, escape = FALSE, caption = "
        Abundancia relativa de los ordenes presentes en las estaciones 
      muestreadas del rio Frio y el rio Neusa. ") %>%
     kable_styling(latex_options="scale_down")

View(abundance_metrics(RLQ$L_table[-2],absolute = TRUE))
```

### Respuesta de los rasgos funcionales

Las proyecciones de las categorías de cada rasgo funcional  se proyectaron en 
el plano factorial producido por el análisis RLQ (figura 3), siendo el primer eje 
el más relevante en el análisis puesto que comprime el 85% de la inercia observada
en las tablas de condiciones ambientales (R) y rasgos funcionales (Q).   

El análisis fourthcorner revela que existen correlaciones significativas (p = 0.05) 
entre la temperatura, la turbidez y el oxigeno disuelto con el primer eje del plano
factorial (Anexo 4) confirmando las tendencias observadas en el PCA.  

Cuando en el plano aumenta el oxigeno disuelto y disminuye la turbidez
se puede ver una tendencia hacia  el aumento de organismos raspadores que se 
alimentan principalmente de algas y detritos finos (Fig 4 A y B) de pequeños
tamaños (<1cm) con cuerpos redondeados  y/o aplanados y que presentan
hábitos natatorios o excavadores (Fig 4 D, E y F). Cuando la acidez y la turbidez
del agua aumenta la tendencia favorece a los organismos trituradores y a los 
predadores (Fig 4 A y B) de forma cilíndrica y tamaño medio (1-2 cm) que se
encuentran sobre la superficie bentónica (Fig 4 D, E y F). La figura 3C muestra 
que las formas de respiración de los macroinvertebrados no presentan tendencias 
fuertes en relación a el gradiente ambiental.


```{r rlq ,  message=FALSE, warning=FALSE, cache= FALSE, echo=FALSE, fig.height= 11, fig.width= 10, fig.cap= "Analisis RLQ de los rios estudiados. A-F) Proyección de las categorias en el plano factorial del análisis RLQ. El primer eje RLQ concentra el 85% de la variación. El valor de d representa el tamaño de la cuadricula. Los codigos de las categorias se pueden encontrar en la tabla 1."}

rlq1 <- make_rlq(RLQ$R_table, RLQ$L_table, RLQ$Q_table, parameters = parameters )

group <- factor(RLQ[["R_table"]]$Tipo_Estacion)
estations <- cbind(Grupo = group, rlq1$lR) 
mean_estations <- estations %>% 
                 group_by(Grupo) %>%
                summarise(across(.cols = everything() , mean))

custom_palette <- c("#FF6F00FF", "#C71000FF", "#008EA0FF", "#8A4198FF")
rasgos <-  c("A) Tipo Alimento", 
             "B) Habitos Alimenticios", 
             "C) Respiracion",
             "D) Forma Corporal", 
             "E) Movilidad",
             "F) Tamaño Maximo")

{
    par(mfrow= c(3,2))

    {
        plot(1, type="n", xlab="", ylab="", 
             ylim = c(-3,3), xlim = c(-3,3), axes = FALSE);
        palette(custom_palette)
        points(estations[[2]], estations[[3]],
               col = estations$Grupo, pch = 18);
        text(mean_estations[[2]], mean_estations[[3]],
               labels =  mean_estations$Grupo,
               col = custom_palette)
        par(new= TRUE);
        palette(gray(0:1));
        s.arrow(rlq1$co[1:6,], boxes = TRUE,  clabel = 2,
                ylim = c(-1,1), xlim = c(-1.5,1.5),
                sub = rasgos[1], csub = 2.5);
        # s.label(rlq1$l1, boxes = FALSE, add.plot = TRUE, clabel = 2);
      
    }
  
    {
        plot(1, type="n", xlab="", ylab="", 
             ylim = c(-3,3), xlim = c(-3,3), axes = FALSE);
        palette(custom_palette)
        points(estations[[2]], estations[[3]],
               col = estations$Grupo, pch = 18);
        text(mean_estations[[2]], mean_estations[[3]],
               labels =  mean_estations$Grupo,
               col = custom_palette)
        par(new= TRUE);
        palette(gray(0:1));
        s.arrow(rlq1$co[7:11,], boxes = TRUE,  clabel = 2,
                ylim = c(-1,1), xlim = c(-1.5,1.5),
                sub = rasgos[2], csub = 2.5);
        # s.label(rlq1$l1, boxes = FALSE, add.plot = TRUE, clabel = 2);
      
    }
  
    {
        plot(1, type="n", xlab="", ylab="", 
             ylim = c(-3,3), xlim = c(-3,3), axes = FALSE);
        palette(custom_palette)
        points(estations[[2]], estations[[3]],
               col = estations$Grupo, pch = 18);
        text(mean_estations[[2]], mean_estations[[3]],
               labels =  mean_estations$Grupo,
               col = custom_palette)
        par(new= TRUE);
        palette(gray(0:1));
        s.arrow(rlq1$co[12:15,], boxes = TRUE,  clabel = 2,
                ylim = c(-1,1), xlim = c(-1.5,1.5),
                sub = rasgos[3], csub = 2.5);
        # s.label(rlq1$l1, boxes = FALSE, add.plot = TRUE, clabel = 2);
      
    }
    
    {
        plot(1, type="n", xlab="", ylab="", 
             ylim = c(-3,3), xlim = c(-3,3), axes = FALSE);
        palette(custom_palette)
        points(estations[[2]], estations[[3]],
               col = estations$Grupo, pch = 18);
        text(mean_estations[[2]], mean_estations[[3]],
               labels =  mean_estations$Grupo,
               col = custom_palette)
        par(new= TRUE);
        palette(gray(0:1));
        s.arrow(rlq1$co[16:19,], boxes = TRUE,  clabel = 2,
                ylim = c(-1,1), xlim = c(-1.5,1.5),
                sub = rasgos[4], csub = 2.5);
        # s.label(rlq1$l1, boxes = FALSE, add.plot = TRUE, clabel = 2);
      
    }
    
    {
        plot(1, type="n", xlab="", ylab="", 
             ylim = c(-3,3), xlim = c(-3,3), axes = FALSE);
        palette(custom_palette)
        points(estations[[2]], estations[[3]],
               col = estations$Grupo, pch = 18);
        text(mean_estations[[2]], mean_estations[[3]],
               labels =  mean_estations$Grupo,
               col = custom_palette)
        par(new= TRUE);
        palette(gray(0:1));
        s.arrow(rlq1$co[20:25,], boxes = TRUE,  clabel = 2,
                ylim = c(-1,1), xlim = c(-1.5,1.5),
                sub = rasgos[5], csub = 2.5);
        # s.label(rlq1$l1, boxes = FALSE, add.plot = TRUE, clabel = 2);
      
    }
    
    {
        plot(1, type="n", xlab="", ylab="", 
             ylim = c(-3,3), xlim = c(-3,3), axes = FALSE);
        palette(custom_palette)
        points(estations[[2]], estations[[3]],
               col = estations$Grupo, pch = 18);
        text(mean_estations[[2]], mean_estations[[3]],
               labels =  mean_estations$Grupo,
               col = custom_palette)
        par(new= TRUE);
        palette(gray(0:1));
        s.arrow(rlq1$co[26:30,], boxes = TRUE,  clabel = 2,
                ylim = c(-1,1), xlim = c(-1.5,1.5),
                sub = rasgos[6], csub = 2.5);
        # s.label(rlq1$l1, boxes = FALSE, add.plot = TRUE, clabel = 2);
    }
}
  

```

Sin embargo, los resultados del análisis fourthcorner solo respaldan algunas de 
estas tendencias, encontrándose correlaciones negativas (p = 0.5) entre el 
primer eje del plano factorial y los organismos que se alimentan de algas (Miph)
o presentan formas  esféricas (SPH) y correlaciones positivas cuando los organismos 
son trituradores (SH), presentan formas cilíndricas (CYL) o son de tamaño medio
(Anexo 4). 


## Discusión

### Estructura de las comunidades

### Respusta funcional al gradiente ambiental 


## Conclusiones

\newpage

## Bibliografía

Charvet, S., Kosmala, A., & Statzner, B. (1998). Biomonitoring through biological traits of
benthic macroinvertebrates: Perspectives for a general tool in stream management.
Archiv Fuer Hydrobiologie, 142(4), 415-432.  

Chevenet, F., Dolédec, S. and Chessel, D. (1994) A fuzzy coding approach for the analysis 
of long-term ecological data. Freshwater Biology, 31, 295–309.

Cummins, K. W., Merritt, R. W., & Andrade, P. C. (2005). The use of invertebrate
functional groups to characterize ecosystem attributes in selected streams and rivers in
south Brazil. Studies on Neotropical Fauna and Environment, 40(1), 69-89.  

Ding, N., Yang, W., Zhou, Y., González-Bergonzoni, I., Zhang, J., Chen, K., Vidal, N.,
Jeppesen, E., Liu, Z., & Wang, B. (2017). Different responses of functional traits and
diversity of stream macroinvertebrates to environmental and spatial factors in the
Xishuangbanna watershed of the upper Mekong River Basin, China. Science of The Total
Environment, 574, 288-299.  

Doledec, S., Chessel, D., ter Braak, C.J.F. and Champely, S. (1996) Matching species 
traits to environmental variables: a new three-table ordination method. Environmental
and Ecological Statistics, 3, 143–166.

Dolédec, S., Phillips, N., Scarsbrook, M., Riley, R. H., & Townsend, C. R. (2006).
Comparison of structural and functional approaches to determining landuse effects on
grassland stream invertebrate communities. Journal of the North American Benthological
Society, 25(1), 44-60.  

Domínguez, E., & Fernández, H (eds). (2019), Macroinvertebrados bentónicos
sudamericanos. Sistemática y biología. Fundación Miguel Lillo, Tucumán, Argentina.
Fossati, O., Wasson, J.-G., Héry, C., Salinas, G., & Marín, R. (2001). Impact of sediment
releases on water chemistry and macroinvertebrate communities in clear water Andean
streams (Bolivia). Archiv Für Hydrobiologie, 151(1), 33-50. 

Dray S, Dufour A (2007). “The ade4 Package: Implementing the Duality Diagram for Ecologists.” 
Journal of Statistical Software_, *22*(4), 1-20. doi: 10.18637/jss.v022.i04 (URL:
https://doi.org/10.18637/jss.v022.i04).

Dray, S. and Legendre, P. (2008) Testing the species traits-environment relationships: 
the fourth-corner problem revisited. Ecology, 89, 3400–3412.

Dudgeon, D. (2011). Tropical Stream Ecology. Elsevier. USA

Fierro, P., Valdovinos, C., Vargas-Chacoff, L., Bertrán, C., & Arismendi, I. (2017).
Macroinvertebrates and Fishes as Bioindicators of Stream Water Pollution. Water Quality. 
https://doi.org/10.5772/65084  

Gayraud, S., Statzner, B., Bady, P., Haybachp, A., Schöll, F., Usseglio‐Polatera, P., &
Bacchi, M. (2003). Invertebrate traits for the biomonitoring of large European rivers: An
initial assessment of alternative metrics. Freshwater Biology, 48(11), 2045-2064.  

Lemus-Portillo, C., Echavarria-Pedraza, M. C., Rojas, J. E., Alvarez-Diaz, J. E.,
León-Pardo, K. J., Aguilar-Orjuela, S., & Maldonado, J. F. (2020). Estado de conservación
y distribución del pez de agua dulce Capitán de la Sabana Eremophilus mutisii 
en Cundinamarca, Colombia. Actualidades Biológicas, 42(112).  

Metcalfe, J. L. (1989). Biological water quality assessment of running waters 
based on macroinvertebrate communities: History and present status in Europe. 
Environmental Pollution, 60(1), 101–139. https://doi.org/10.1016/0269-7491(89)90223-6  

Motta Díaz, A. J., Longo, M., & Aranguren-Riaño, N. (2020). Variación temporal de la
diversidad taxonómica y rasgos funcionales de los macroinvertebrados acuáticos en ríos
temporales en la isla de Providencia, Colombia. Actualidades Biológicas, 39(107), 82-100.  

Statzner, B., Bady, P., Dolédec, S., & Schöll, F. (2005). Invertebrate traits for the
biomonitoring of large European rivers: An initial assessment of trait patterns in least
impacted river reaches. Freshwater Biology, 50(12), 2136-2161.  

Pinilla, G. (2010). An index of limnological conditions for urban wetlands of 
Bogotá city, Colombia. Ecological Indicators, 10(4), 848–856. https://doi.org/10.1016/j.ecolind.2010.01.006  

R Core Team (2020). R: A language and environment for statistical computing.
R Foundation for Statistical Computing, Vienna, Austria. URL https://www.R-project.org/.

Tomanova, S., Moya, N., & Oberdorff, T. (2008). Using macroinvertebrate biological traits
for assessing biotic integrity of neotropical streams. River Research and Applications,
24(9), 1230-1239. https://doi.org/10.1002/rra.1148.  

Toro, J. A. R., Ramirez, N. J. A., Lopez, J. P. S., Atilano, E. H., & Macías, F. de J. V. (2020).
Energía calórica, biomasa y estructura de los macroinvertebrados acuáticos en la reserva
La Nitrera, Concordia, Antioquia, Colombia. Acta Biológica Colombiana, 25(1), 29-36.  

Torres-Zambrano, N. N., & Torres-Zambrano, D. R. (2016). Macroinvertebrados acuáticos
de la quebrada Los Alisos, Firavitoba—Boyacá. Intropica, 11, 47-56.  

Usseglio‐Polatera, P. (1994). Theoretical habitat templets, species traits, and
species richness: Aquatic insects in the Upper Rhône River and its floodplain.
Freshwater Biology, 31(3), 417–437. https://doi.org/10.1111/j.1365-2427.1994.tb01749.x  


## Anexos

\newpage
\blandscape

```{r rasgos }
rasgos_func <- read.csv("../Data/rlq/QTable.csv")
rasgos <-  c("A) Tipo Alimento", 
             "B) Habitos Alimenticios", 
             "C) Respiracion",
             "D) Forma Corporal", 
             "E) Movilidad",
             "F) Tamaño Maximo")

rasgos_func %>%
  kbl(booktabs = TRUE, escape = FALSE, caption = "
        Anexo 1. Clasificación de los rasgos funcionales  basados en 
        la metodologia del Fuzzy Code para las familias de 
        macroinvertebrados presentes en los rios de la Sabana 
        de Bogotá.") %>%
     kable_styling(latex_options="scale_down") %>%
     add_header_above(c("",
                      "Tipo Alimento" = 6, 
                      "Habitos Alimenticios" = 5, 
                      "Respiracion" = 4,
                      "Forma Corporal" = 4, 
                      "Movilidad" = 6,
                      "Tamaño Maximo" = 5))

```
\elandscape

\newpage

### Anexo 2

El análisis univariado de las variables fisicoquimicas e hidrologicas. En las 
figuras se observan los diagramas de caja que corresponde a un análisis descriptivo
de las variables. Los gráficos cuantil-cuantil indican que tan bien se ajustan 
las variables a una distribución normal.  

```{r anexos_eda, message=FALSE, warning=FALSE, cache=FALSE,include = TRUE, echo = FALSE, fig.height= 9, fig.width= 9, fig.align='center'}

box_plots <-  univariate_graphical_eda(data = complete, type_plot = 'boxplot')

  box_plots$OxDisuelto + 
  box_plots$Turbidez +
  box_plots$Conductividad + 
  box_plots$Temperatura +
  box_plots$pH +
  box_plots$Profundidad + 
  box_plots$Velocidad +
  plot_layout(ncol = 3, byrow = FALSE ) 
  
```



### Anexo 3

Resultados del análisis de varianza multivariado de los grupos generados por el 
análisis de cluster. El análisis post hoc incluyo multiples tests de hotelling 
entre los pares de grupos. 


```{r manova,  message=FALSE, warning=FALSE}
results_manova <- list(
Global =  make_manova(data = complete, global = TRUE),
NeuA_NeuB  = make_manova(data = complete, est1 = "NeusaA", est2 = "NeusaB"),
NeuA_FrioA =  make_manova(data = complete, est1 = "NeusaA", est2 = "FrioA"),
NeuA_FrioB =  make_manova(data = complete, est1 = "NeusaA", est2 = "FrioB"),
NeuB_FrioA =  make_manova(data = complete, est1 = "NeusaB", est2 = "FrioA"),
NeuB_FrioB =  make_manova(data = complete, est1 = "NeusaB", est2 = "FrioB"),
FrioA_FrioB =  make_manova(data = complete, est1 = "FrioA", est2 = "FrioB")
)

 for (i in 1:6) { 
     
     cat(" ")  
     print(names(results_manova[i]))
     print(summary(results_manova[[i]]))
     cat(" ")
     
 }

```


```{r fourthcorner1, message= FALSE, warning= FALSE, include= FALSE, cache= FALSE}

fourth_corner <- make_rlq(RLQ$R_table, RLQ$L_table, RLQ$Q_table,
                          fourthcorner = TRUE, parameters = parameters)
fourth_corner$envir

f4c_traits <- as.data.frame(print(fourth_corner$traits), 
                            stringsAsFactors = FALSE, 
                            row.names = NULL, 
                            optional = TRUE) %>%
              subset(select= -Stat) %>%
              subset(select= -Alter) 
 
f4c_traits <- f4c_traits %>% 
              subset(grepl("AxcR1", .$Test)) %>%
              remove_rownames() %>%
              column_to_rownames("Test")

f4c_envir <- as.data.frame(print(fourth_corner$envir), 
                           stringsAsFactors = FALSE,
                           row.names = NULL, 
                           optional = TRUE) %>%
             subset(select= -Stat) %>%
             subset(select= -Alter) 
 
f4c_envir <- f4c_envir %>% 
  subset(grepl("AxcQ1", .$Test)) %>%
  remove_rownames() %>%
  column_to_rownames("Test")



```

```{r fourthcorner2, message= FALSE, warning= FALSE }
res_4c <- rbind(f4c_traits, f4c_envir)

res_4c %>%
      kbl(booktabs = TRUE, escape = FALSE,
          caption = "Anexo 4: Resultados del Analisis Fourthcorner de las correlaciones
                     (Pearson) entre el primer eje del plano factorial RLQ y los
                      rasgos funcionales y las variables ambientales.
                      Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1 ") %>%
      kableExtra::group_rows("Traits", 1, 30) %>%
      kableExtra::group_rows("Enviromental", 31, 35)

```




