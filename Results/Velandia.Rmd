---
title: "Selección de Rasgos Funcionales de las comunidades de macroinvertebrados para su uso como variables indicadoras de calidad en dos ríos de la sabana de Bogotá"
author: "Michael Sebastián Velandia Garavito"
date: "4/08/2021"
fontsize: 12pt
header-includes:
- \usepackage{pdflscape}
- \newcommand{\blandscape}{\begin{landscape}}
- \newcommand{\elandscape}{\end{landscape}}
- \usepackage{caption}
- \captionsetup[figure]{font=small}
output:
  word_document: default
  html_document: default
  pdf_document: default
always_allow_html: true
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = FALSE, message=FALSE, warning=FALSE)

source("../Code/metodos.R")
source("../Code/eda.R")
source("../Code/biological_index_COL.R")


## Load RLQ Data

RTable <- "../Data/rlq/RTable.csv"
LTable <- "../Data/rlq/LTable.csv"
QTable <- "../Data/rlq/QTable.csv"

RLQ <- load_rlq(RTable, LTable ,QTable)

parameters <- c("Temperatura", "OxDisuelto", "pH", 
                "Conductividad", "Turbidez") 

## Load Complete Data

complete <- read.csv("../Data/muestreo_completo.csv",
                     stringsAsFactors = FALSE)


```

## Introducción

Las condiciones ambientales de una gran cantidad de ríos en las áreas tropicales
se ha deteriorado gradualmente a raíz del rápido crecimiento de las poblaciones 
humanas, los cambios en el uso del suelo, el desarrollo agrícola e industrial y 
las actividades extractivas (Dudgeon, 2008). Desde los años 90 se ha venido 
implementando el monitoreo con índices que integran las variables fisicoquímicas
para la medición de la calidad de las aguas de los ríos y su integridad y, más 
recientemente, se han incorporado los índices bióticos que utilizan una variedad
de grupos taxonómicos, entre ellos los macroinvertebrados (Pinilla, 2010). Las 
experiencias en países templados (Fierro *et al*., 2017; Metcalfe, 1989) han 
demostrado que el uso de los macroinvertebrados para el biomonitoreo presenta 
ventajas sobre los índices físico-químicos, pues integran información de cambios
al corto y el largo plazo en un amplio rango de variables ambientales
(Dudgeon, 2008; Fierro *et al*., 2017).

El uso de macroinvertebrados para el biomonitoreo de la calidad de agua ha
estado tradicionalmente enmarcado en un enfoque taxonómico que se basa en la 
tolerancia de ciertos taxones a la polución. Sin embargo, uno de los mayores 
limitantes para esta aproximación es la dificultad de hacer una determinación de
los organismos de manera rápida y a un suficiente nivel de detalle (género o
especie) para usarlos en programas de monitoreo(Cummins *et al*., 2005).

Desde hace algunas décadas, el estudio de los rasgos funcionales de las especies
de sistemas lóticos ha demostrado una gran utilidad como un buen indicador de 
la respuesta de las comunidades a diversos tipos de disturbios, entre los que se
encuentran los de naturaleza antrópica (Ding *et al*., 2017), y en consecuencia se
ha ido desarrollando un enfoque funcional para el biomonitoreo de sistemas 
lóticos, principalmente en zonas templadas, con algunos ejemplos en el 
Neotrópico (Tomanova *et al*., 2008).

Gran parte de los estudios que se han realizado sobre el uso de la diversidad y
los rasgos funcionales en bioindicación se han ejecutado en países de zonas 
templadas (Charvet *et al*., 1998; Gayraud *et al*., 2003; Statzner *et al*., 2005;
Dolédec *et al*., 1996; Dolédec *et al*., 2006), siendo mucho menor la cantidad de
trabajos llevados a cabo en el trópico (Ding *et al*., 2017). Una alta proporción 
de las investigaciones en el Neotrópico sobre este tema se han hecho en Brasil, 
con algunos otros ejemplos en países como Ecuador o Bolivia (Fossati *et al*., 2001; 
Cummins *et al*., 2005; Tomanova *et al*., 2008). En Colombia se han realizado 
algunos acercamientos sobre aspectos funcionales de los macroinvertebrados en la
región insular (Motta Díaz *et al*., 2020), en Antioquia (Toro *et al*., 2020) y en
Boyacá (Torres-Zambrano y Torres-Zambrano, 2016), pero en ninguno de ellos se 
ha buscado identificar los rasgos más apropiados para la construcción de índices
biológicos.

Un primer paso para el desarrollo de un índice biológico de macroinvertebrados
con un enfoque funcional en los ríos de la sabana de Bogotá, es la evaluación
de los rasgos funcionales de las comunidades de dichos macroinvertebrados con 
el fin de evaluar cuál es su respuesta a los parámetros fisicoquímicos de estos
cuerpos de agua. En el presente trabajo se busca evaluar dicha respuesta y hacer
una comparación con las mediciones obtenidas por los índices biológicos 
tradicionales.


## Metodología  

### Área de estudio y muestreo 

Los macroinvertebrados utilizados provinieron de una serie de muestreos 
realizados entrelos años 2017 y 2019 en 11 estaciones de muestreo ubicadas en 
los ríos Frío y Neusa, en los municipios de Cajicá, Chía y Cogua (Fig. 1), en el
marco del “Programa nacional para la conservación de la especie endémica de 
Colombia pez capitán de la sabana (*Eremophilus mutisii*)” liderado por el 
Ministerio del Medio Ambiente y la Universidad Manuela Beltrán (Lemus-Portillo 
*et al*., 2020). En cada punto de muestreo se tomaron datos hidrológicos y se 
midieron in situ las variables de oxígeno disuelto, conductividad, pH, 
temperatura y turbidez. Los macroinvertebrados se colectaron con red Surber, 
red D y red de mano, las cuales son metodologías estándar de amplio 
reconocimiento (Domínguez y Fernández, 2009).

```{r sampling estation, message=FALSE, warning=FALSE, cache=TRUE, fig.height= 4, fig.width= 6, fig.align='center', echo=FALSE, fig.cap= " Localización espacial de las estaciones de muestreo. El área de muestreo del río Frío (izquierda) se ubicó en su cuenca baja, municipios de Cajicá y Chía, con una longitud del recorrido aproximadamente de 13,5 km . El área de muestreo del río Neusa (derecha) se ubica en el municipio de Cogua, tiene puntos de muestreo antes y después de la represa del Neusa y la longitud del recorrido es aproximadamente de 13 km."}

estaciones <- read.csv("../Data/other/estaciones.csv")
plot_est(estaciones)

```

### Índices ecológicos y de calidad del agua

Con base en la composición de invertebrados acuáticos se calcularon los índices
de diversidad de Shannon-Weaver y de Simpson, así como los índices de calidad 
del agua BMWP/Col y ASPT (“average score per taxón”) (Roldán, 2003) y el índice 
biótico de familias (FBI) de Hilsenhoff (1987).

### Rasgos Funcionales 

Los organismos, pertenecientes a la colección de macroinvertebrados de la 
Universidad Manuela Beltrán, se identificaron hasta Familia. Los rasgos 
funcionales se eligieron de acuerdo a la propuesta de Tomanova *et al*. (2008) e
incluyeron aspectos tróficos (alimentación y hábitos alimenticios), fisiológicos
(respiración) morfológicos (tamaño y forma corporal) y comportamentales 
(movilidad y fijación al sustrato). Se siguió la metodología del *‘Fuzzy coding’*
(Chevenet *et al*., 1994; Usseglio‐Polatera, 1994) que consiste en asignar a cada
familia un valor entre 0 y 3 para cada uno de los rasgos funcionales (Tabla 1),
siendo 0 ausencia del rasgo y 3 total afinidad con el rasgo; el valor 1 se otorga
si la familia tiene vínculos débiles con la característica y el valor 2 se da
si el taxón se relaciona moderadamente con el rasgo considerado. Esta asignación
se hizo por medio de observaciones y mediciones directas en el laboratorio, 
apoyadas en una revisión de la literatura disponible.


```{r table_funct, echo=FALSE}

data  <- read.csv("../Data/other/rasgos_funcionales_tabla.csv", 
                  check.names = FALSE)
doc.type <- knitr::opts_knit$get('rmarkdown.pandoc.to')

table_pdf <- expression(
    data %>%
        kbl(booktabs = TRUE, escape = FALSE, caption = "
            Categorias de los Rasgos Funcionales. Tomado y modificado de 
            Tomanova et al. (2008) ") %>%
        collapse_rows(columns = 1, valign = "middle", latex_hline = "major") %>% 
        kable_styling(full_width = FALSE)
)

table_word <- expression(
    NULL
)

parse_table(latex = table_pdf, docx = table_word)

```

### Métodos numéricos y estadísticos

Con el fin de establecer el gradiente ambiental, se realizó un análisis de clúster
y un análisis de componentes principales (PCA). Para establecer diferencias entre
las condiciones fisicoquímicas de las estaciones se realizó un análisis de 
varianza multivariado (MANOVA). La evaluación de la respuesta de los rasgos 
funcionales al gradiente ambiental se realizó con un análisis de co-inercia RLQ,
que vincula las matrices de variables ambientales *R* y de rasgos funcionales *Q* 
por medio de una matriz de abundancia *L* (Dolédec *et al*., 2006). Para probar 
las asociaciones individuales de cada rasgo funcional con las variables ambientales
se realizó un análisis *‘fourth corner’* (Dray y Legendre, 2008). Todos los análisis
se hicieron con el software R versión 3.6.3 (R Core Team, 2020), utilizando 
el paquete ade4 (Dray y Dufour, 2007).

## Resultados

### Evaluación gradiente ambiental 

Las características medioambientales de las estaciones evaluadas se resumen en 
la tabla 2. Los resultados del análisis de clúster muestran que las estaciones
evaluadas se pueden clasificar en cuatro grupos diferentes (Fig 2B). Se observa 
una clara diferencia entre las estaciones del río Frío y las estaciones del río
Neusa. En el río Frío se observa que las estaciones ubicadas en la vereda Canelón
de Cajicá forman un grupo (FríoB) y los muestreos de la estación ubicada en la
zona urbana de Chía se separan en otro grupo (FríoA). En el río Neusa las estaciones
antes del embalse del Neusa (NeusaA) se diferencian fisicoquímicamente de aquellas
después del reservorio (NeusaB). Los resultados del MANOVA y del análisis *post hoc*
entre estos cuatro grupos indica que existen diferencias significativas 
entre ellos (Anexo 3).

Las características hidrológicas (profundidad media y velocidad de la corriente) 
de los ríos no variaron en gran medida entre las estaciones (Tabla 2 y Anexo 2)
y por lo tanto aportaron poco al gradiente ambiental, por lo que se excluyeron 
de los análisis posteriores. 

```{r summary, echo=FALSE,  message=FALSE, warning=FALSE, fig.height= 6, fig.width= 11, fig.align='center' }

summary_data <- (function () {
    summary_data <- summary_statistics(data = complete)
    mean <-  summary_data$mean %>% 
             column_to_rownames("Estacion") %>%
             round(digits = 2)
    sd <-  summary_data$sd %>% 
             column_to_rownames("Estacion") %>%
             round(digits = 2)
    data <- list(Estacion = summary_data$mean[["Estacion"]])
    
    names <- c("Estacion", "Temperatura (C°)", "Ox disuelto (mg/L)", "pH",
             "Conductividad (µS/cm)", "Turbidez (NTU)", 
             "Profundidad (cm)", "Velocidad (m/s)",
             "Altitud (msnm)")
    
    for (i in 1:7){
        a <- paste0( mean[[i]], '±', sd[[i]]) 
        data[[1+i]] <- a
    }
    
    data <- as.data.frame(data)
    names(data) <-  names(summary_data$mean[1:8])
    data <- cbind(data,summary_data$mean[["Altitud"]])
    names(data) <- names
    
    data <- data %>%
      column_to_rownames("Estacion")
        

    
    return(data)
})()


table_pdf <- expression(
summary_data %>%
     kbl(booktabs = TRUE, escape = FALSE, 
          caption = "Condiciones ambientales de los rios Neusa y Frio
                     en las estaciones trabajadas ",
          col.names = linebreak( c("Temperatura\n(C°)", 
                                   "Ox disuelto\n(mg/L)", "pH",
                                   "Conductividad\n(µS/cm)", "Turbidez\n(NTU)", 
                                   "Profundidad\n(cm)", "Velocidad\n(m/s)",
                                   "Altitud\n(msnm)"), 
                                 align = "c")) %>% 
      kable_styling(latex_options="scale_down") %>%
      pack_rows(index=c("Rio Frío" = 5, "Rio Neusa" = 6))   
)

table_word <- expression(
    NULL
)

parse_table(latex = table_pdf, docx = table_word)

```

Los resultados del PCA mostraron que el 70% de la varianza de las variables
fisicoquímicas se concentró en los dos primeros componentes (Fig 2C). El primer 
componente estuvo explicado principalmente por el oxígeno disuelto, la turbidez
y la temperatura del agua y fue por lo tanto el eje más relevante en la evaluación
del gradiente ambiental de las estaciones evaluadas. En el biplot del PCA (Fig 2A)
se puede observar un gradiente de derecha a izquierda en el que se acidifica el 
agua, se disminuye el oxígeno disuelto y aumenta la turbidez. El gradiente de 
temperatura está relacionado con las diferencias de altura entre estaciones 
(Tabla 2).

Las mediciones de pH realizadas en el río Frío tuvieron una alta variabilidad 
entre los muestreos, que contrastó con la de los datos del río Neusa, cuyas
estaciones en general fueron más homogéneas y presentaron un pH neutro. La 
conductividad también tuvo un comportamiento diferencial entre los ríos. En el
caso del río Neusa, las estaciones anteriores a la represa (Neusa A) obtuvieron
registros más elevados que los de las estaciones posteriores a la represa (Neusa B).
Sin embargo, cabe resaltar que en las estaciones del grupo Neusa A, la 
variabilidad entre muestreos fue mucho más elevada (Anexo 2) que en el resto de 
sitios; al parecer, esta alta conductividad podría deberse a diferencias entre 
los períodos de muestreo. En el río Frío el gradiente de conductividad fue el 
esperado, sin muchas diferencias entre las estaciones río arriba (Frío B) y una 
alta conductividad en la estación Frío5.


```{r eda,  message=FALSE, warning=FALSE, cache= FALSE, echo=FALSE, fig.height= 6, fig.width= 9, fig.align='center', fig.cap= " Analisis de Componentes Principales y Analisis Jerarquico de Cluster. A) Proyección de las variables fisicoquimicas en el plano del ACP. B) Dendrogama de las estaciones. Se utilizo como la distancia euclidia como metrica de similitud y se computo utilizando el algoritmo UPGMA C) Varianza explicada por los componentes del ACP. "}


plot_pca <- make_pca(RLQ$R_table, plot_type = "Tipo_Estacion", 
                     parameters = parameters )

pca <- make_pca(RLQ$R_table, plot = FALSE)

group <- factor(RLQ[["R_table"]]$Estacion)

estations <- cbind(Grupo = group, as.data.frame(pca$x))

mean_estations <- estations %>% 
    group_by(Grupo) %>%
    summarise(across(.cols = everything() , mean))

plot_pca2 <- plot_pca$biplot + 
  geom_text_repel(data= mean_estations, mapping = aes(PC1, PC2, label = Grupo), size =3.5 )

plot_cluster <-  make_cluster(RLQ$R_table, parameters = parameters)

dendogram <- fviz_dend(plot_cluster,  main = "", palette = 'futurama', k = 4) 

layout <- "
AAAAAAACCCC
AAAAAAABBBB
AAAAAAABBBB
AAAAAAABBBB
"
plot_pca2 + 
  dendogram + 
  plot_pca$eigenvalues + 
  plot_layout(design = layout, guides = 'collect') +
  guide_area() +
  plot_annotation(tag_levels = 'A') 
  


custom_palette <- c("#FF6F00FF", "#C71000FF", "#008EA0FF", "#8A4198FF")

```

### Indices bioticos 

#### Diversidad 

La diversidad alfa de las estaciones muestreadas fue similar en ambos ríos, y en
general no mostró relación con el gradiente ambiental establecido (Fig 3B). Salvo
la estación Fri5, que presentó una baja riqueza de familias, las estaciones del
río Frío tuvieron valores similares tanto en la riqueza de familias como en los 
índices de diversidad alfa. Se obtuvo una alta presencia de gastrópodos y de 
anfípodos de la familia Hyallelidae (Tabla 3).

El río Neusa también presentó una diversidad alfa similar entre sus estaciones,
a excepción de la estación Neu7, que registró una mayor riqueza de familias, así 
como valores más altos de los índices de diversidad. A pesar de estas semejanzas
en la diversidad, la composición de las comunidades de invertebrados del río 
Neusa difirió en gran medida con respecto a la del río Frío, puesto que evidenció
una alta cantidad de dípteros (familias Chironomidae, Tipullidae y Simullidae) y
una escasa presencia de gastrópodos y anfípodos (Tabla 3).

El análisis de la diversidad beta mostró una diferenciación entre las estaciones
de ambos ríos, menos en la estación Fri5, que presentó una composición similar a
la encontrada en las estaciones del río Neusa (Fig 3A). Sin embargo, al ver los
clústeres que forman estos ríos, no se vio un patrón consistente con el gradiente
ambiental detectado (Fig 2A).

#### Bioindicadores

Los valores del índice BMWP/Col mostraron valores relativamente altos que indican
aguas aceptables con un ligero nivel de contaminación, a excepción de las estaciones
Neu1 y Fri5, que presentaron valores muy bajos. Esto fue poco consistentes tanto 
con el ASPT como con el índice de Hilsenhoff, puesto que estos últimos señalaron
que la calidad de las aguas en ambos ríos fue de dudosa calidad, con algunas 
estaciones que estuvieron en estado critico (Fig 3 B). Los valores de estos 
índices fueron en general inconsistentes con el patrón ambiental observado y con 
los grupos generados por el análisis de clúster de las variables ambientales 
(Fig 2A y Fig 2B).


```{r biological_index, include= FALSE}

data <- read.csv("../Data/rlq/LTable.csv") %>% 
    select(-c(Muestra)) %>%
    group_by(Estacion) %>%
    summarise(across(everything(), mean)) %>%
    column_to_rownames("Estacion") %>%
    as.matrix() %>%
    t() 

index_table <- data.frame( 'BMWP COL' = bmwp_COL(data)$bmwp_scores,
            'ASPT' = bmwp_COL(data, ASPT = TRUE),
            'FBI'  = hillsenhoff_index(data)$hillsenhoff_scores,
            check.names = FALSE)


```


```{r diversity, include=FALSE}

data <- RLQ$L_table %>% 
    select(-Muestra, -Tipo_Estacion) %>%
    group_by(Estacion) %>%
    summarise(across(everything(), mean)) %>%
    column_to_rownames("Estacion") 

macroab1 <- complete %>% 
  group_by(Estacion, Muestra) %>% 
  summarise( Familias = n_distinct(Familia),
             Total_Macro = sum(Individuos)) %>%
  select(-Muestra ) %>%
  group_by(Estacion) %>% 
  summarise(across(everything(), mean))  

macroab2 <- summary_statistics(data = complete)$macroinvertebrates

diversity_table <- data.frame(
                         'H' = round(diversity(data, index = 'shannon'), 2),
                         '1-D' = round(diversity(data, index = 'invsimpson'), 2),
                         'n' = paste0(round(macroab1$Total_Macro, 0),
                                      " (",macroab2$Total_Macro, ")"), 
                         'k' = paste0(round(macroab1$Familias, 0),
                                      " (",macroab2$Familias, ")"), 
                          check.names = FALSE) 
               



data_discussion <- data[c("Chironomidae", "Simuliidae", "Hyalellidae",
                          "Physidae", "Sphaeriidae", "Naididae" )]# to discussion
data_discussion2 <- RLQ$Q_table[c("Chironomidae", "Simuliidae", "Hyalellidae",
                          "Physidae", "Sphaeriidae", "Naididae" ),] %>%
  t() %>% 
  as.data.frame()
# Working in beta diversity

distance_matrix <- read.csv("../Data/other/abundancia_orden.csv") %>% 
                   select(-Muestra) %>%
                   group_by(Estacion) %>%
                   summarise(across(.cols = everything() , mean)) %>%
                   ungroup() %>%
                   column_to_rownames(var = 'Estacion') %>%
                   vegdist(method="bray", binary= FALSE ) 
    

    cluster <-  hclust(distance_matrix, method = "average")
    
    dendogram <- fviz_dend(cluster, k = 1, main = "", palette = 'black')
    
```


```{r div_index_plotm,fig.height= 6, fig.width= 10, fig.align='center', fig.cap= "Diversidad e índices biológicos de las estaciones muestreadas. A) Diversidad beta. Dendrograma de las estaciones basado en el índice Bray-Curtis y computado con el algoritmo UPGMA. B) Tabla de índices de diversidad alfa e indicadores biológicos. H = índice de Shannon-Weaver, 1-D = índice de diversidad de Simpson, n = promedio de individuos por muestreo, k = promedio de familias por muestreo. " }

layout <- c(
  area(t = 1, l = 1, b = 4, r = 3),
  area(t = 1, l = 3, b = 2, r = 4)
)

div_indx <- cbind(diversity_table, index_table) %>%
            tableGrob(theme = ttheme_default(base_size = 10)) %>%
            gtable::gtable_add_cols(unit(0.025, "npc"), 5) %>%
            gtable::gtable_add_cols(unit(0.0125, "npc"), 1)


dendogram + 
  div_indx+
  plot_layout(design = layout, guides = 'collect') +
  plot_annotation(tag_levels = 'A') 
```


```{r ab_table, fig.height= 3, fig.width= 6, fig.align='center'}
data <- read.csv("../Data/other/abundancia_orden.csv") %>% 
    select(-Muestra)

abundance_table <- abundance_metrics(data) %>%
    rownames_to_column() %>%
    mutate(EPT = Ephemeroptera + Trichoptera,
           Turbellaria = Tricladida) %>%
    column_to_rownames() %>%
    select(EPT, Diptera, Amphipoda, Bivalvia, Gastropoda, 
           Hemiptera, Hirudinea, Turbellaria, Oligochaeta) %>%
    round(digits = 2)


table_pdf <- expression(
abundance_table %>%
  kbl(booktabs = TRUE, escape = FALSE, caption = "
        Abundancia relativa de los ordenes presentes en las estaciones 
      muestreadas del río Frío y el río Neusa. ") %>%
     kable_styling(latex_options="scale_down")   
)

table_word <- expression(
    NULL
)

parse_table(latex = table_pdf, docx = table_word)

```

### Respuesta de los rasgos funcionales

Las proyecciones de las categorías de cada rasgo funcional se proyectaron en el 
plano factorial producido por el análisis RLQ (Fig 3), siendo el primer eje el 
más relevante en el análisis, puesto que comprime el 85% de la inercia observada 
en las tablas de condiciones ambientales (R) y de rasgos funcionales (Q).

El análisis ‘fourthcorner’ reveló que existen correlaciones significativas 
(p = 0,05) entre la temperatura, la turbidez y el oxígeno disuelto con el primer
eje del plano factorial (Anexo 4), lo cual confirma las tendencias observadas
en el PCA.

Cuando en el plano factorial aumenta el oxígeno disuelto y disminuye la turbidez,
se puede ver una tendencia hacia el aumento de organismos raspadores que se 
alimentan principalmente de algas y detritos finos (Fig 4A y Fig 4B), que son de
pequeños tamaños (<1cm), con cuerpos redondeados o aplanados y que presentan 
hábitos natatorios o excavadores (Fig 4D, Fig 4E y Fig 4F). Cuando la acidez y
la turbidez del agua aumentan, la tendencia es hacia los organismos trituradores 
y  depredadores (Fig 4A y Fig 4B), de forma cilíndrica y tamaño medio (1-2 cm), 
que se encuentran sobre la superficie bentónica (Fig 4D, Fig 4E y Fig 4F). La 
Fig 4C muestra que las formas de respiración de los macroinvertebrados no 
presentaron tendencias fuertes en relación con el gradiente ambiental.

```{r rlq ,  message=FALSE, warning=FALSE, cache= FALSE, echo=FALSE, fig.height= 11, fig.width= 10, fig.cap= "Análisis RLQ de los ríos estudiados. A-F) Proyección de las categorías en el plano factorial del análisis RLQ. El primer eje RLQ concentra el 85% de la variación. El valor de d representa el tamaño de la cuadricula. Los códigos de las categorías se pueden encontrar en la tabla 1."}

rlq1 <- make_rlq(RLQ$R_table, RLQ$L_table, RLQ$Q_table, parameters = parameters )

group <- factor(RLQ[["R_table"]]$Tipo_Estacion)
estations <- cbind(Grupo = group, rlq1$lR) 
mean_estations <- estations %>% 
                 group_by(Grupo) %>%
                summarise(across(.cols = everything() , mean))

custom_palette <- c("#FF6F00FF", "#C71000FF", "#008EA0FF", "#8A4198FF")
rasgos <-  c("A) Tipo Alimento", 
             "B) Habitos Alimenticios", 
             "C) Respiracion",
             "D) Forma Corporal", 
             "E) Movilidad",
             "F) Tamaño Maximo")

{
    par(mfrow= c(3,2))

    {
        plot(1, type="n", xlab="", ylab="", 
             ylim = c(-3,3), xlim = c(-3,3), axes = FALSE);
        palette(custom_palette)
        points(estations[[2]], estations[[3]],
               col = estations$Grupo, pch = 18);
        text(mean_estations[[2]], mean_estations[[3]],
               labels =  mean_estations$Grupo,
               col = custom_palette)
        par(new= TRUE);
        palette(gray(0:1));
        s.arrow(rlq1$co[1:6,], boxes = TRUE,  clabel = 2,
                ylim = c(-1,1), xlim = c(-1.5,1.5),
                sub = rasgos[1], csub = 2.5);
        # s.label(rlq1$l1, boxes = FALSE, add.plot = TRUE, clabel = 2);
      
    }
  
    {
        plot(1, type="n", xlab="", ylab="", 
             ylim = c(-3,3), xlim = c(-3,3), axes = FALSE);
        palette(custom_palette)
        points(estations[[2]], estations[[3]],
               col = estations$Grupo, pch = 18);
        text(mean_estations[[2]], mean_estations[[3]],
               labels =  mean_estations$Grupo,
               col = custom_palette)
        par(new= TRUE);
        palette(gray(0:1));
        s.arrow(rlq1$co[7:11,], boxes = TRUE,  clabel = 2,
                ylim = c(-1,1), xlim = c(-1.5,1.5),
                sub = rasgos[2], csub = 2.5);
        # s.label(rlq1$l1, boxes = FALSE, add.plot = TRUE, clabel = 2);
      
    }
  
    {
        plot(1, type="n", xlab="", ylab="", 
             ylim = c(-3,3), xlim = c(-3,3), axes = FALSE);
        palette(custom_palette)
        points(estations[[2]], estations[[3]],
               col = estations$Grupo, pch = 18);
        text(mean_estations[[2]], mean_estations[[3]],
               labels =  mean_estations$Grupo,
               col = custom_palette)
        par(new= TRUE);
        palette(gray(0:1));
        s.arrow(rlq1$co[12:15,], boxes = TRUE,  clabel = 2,
                ylim = c(-1,1), xlim = c(-1.5,1.5),
                sub = rasgos[3], csub = 2.5);
        # s.label(rlq1$l1, boxes = FALSE, add.plot = TRUE, clabel = 2);
      
    }
    
    {
        plot(1, type="n", xlab="", ylab="", 
             ylim = c(-3,3), xlim = c(-3,3), axes = FALSE);
        palette(custom_palette)
        points(estations[[2]], estations[[3]],
               col = estations$Grupo, pch = 18);
        text(mean_estations[[2]], mean_estations[[3]],
               labels =  mean_estations$Grupo,
               col = custom_palette)
        par(new= TRUE);
        palette(gray(0:1));
        s.arrow(rlq1$co[16:19,], boxes = TRUE,  clabel = 2,
                ylim = c(-1,1), xlim = c(-1.5,1.5),
                sub = rasgos[4], csub = 2.5);
        # s.label(rlq1$l1, boxes = FALSE, add.plot = TRUE, clabel = 2);
      
    }
    
    {
        plot(1, type="n", xlab="", ylab="", 
             ylim = c(-3,3), xlim = c(-3,3), axes = FALSE);
        palette(custom_palette)
        points(estations[[2]], estations[[3]],
               col = estations$Grupo, pch = 18);
        text(mean_estations[[2]], mean_estations[[3]],
               labels =  mean_estations$Grupo,
               col = custom_palette)
        par(new= TRUE);
        palette(gray(0:1));
        s.arrow(rlq1$co[20:25,], boxes = TRUE,  clabel = 2,
                ylim = c(-1,1), xlim = c(-1.5,1.5),
                sub = rasgos[5], csub = 2.5);
        # s.label(rlq1$l1, boxes = FALSE, add.plot = TRUE, clabel = 2);
      
    }
    
    {
        plot(1, type="n", xlab="", ylab="", 
             ylim = c(-3,3), xlim = c(-3,3), axes = FALSE);
        palette(custom_palette)
        points(estations[[2]], estations[[3]],
               col = estations$Grupo, pch = 18);
        text(mean_estations[[2]], mean_estations[[3]],
               labels =  mean_estations$Grupo,
               col = custom_palette)
        par(new= TRUE);
        palette(gray(0:1));
        s.arrow(rlq1$co[26:30,], boxes = TRUE,  clabel = 2,
                ylim = c(-1,1), xlim = c(-1.5,1.5),
                sub = rasgos[6], csub = 2.5);
        # s.label(rlq1$l1, boxes = FALSE, add.plot = TRUE, clabel = 2);
    }
}
  

```

Los resultados del análisis *‘fourthcorner’* respaldan algunas de estas tendencias,
con el hallazgo de correlaciones negativas (p = 0,5) entre el primer eje del plano
factorial y los organismos que se alimentan de algas (Miph) o presentan formas
esféricas (SPH), así como correlaciones positivas cuando los organismos son 
trituradores (SH), presentan formas cilíndricas (CYL) o son de tamaño medio 
(Anexo 4).

## Discusión

### Estructura de las comunidades

Las comunidades de invertebrados que se encuentran en las estaciones de los ríos
Neusa y Frío muestran variaciones en su composición, especialmente en términos de 
abundancia relativa de los dípteros y los anfípodos presentes en sus estaciones
(Tabla 3). En el río Neusa, las comunidades presentes en las estaciones anteriores
(FríoA) y posteriores (FríoB) a la represa fueron similares y se estuvieron 
conformadas en gran parte por las familias Chironomidae (40-50%) y Simuliidae 
(20-40%), esta última abundante en aguas limpias y bien oxigenadas (Ríos-Touma 
*et al*., 2014). Por su parte, en las estaciones río arriba de la represa se 
encontraron tanto familias de aguas limpias (p.e., Leptoceridae), como familias 
resistentes en mayor o menor medida a la polución, como los bivalvos Sphaeriidae 
y los dípteros Tipulidae. En las estaciones río abajo se hallaron familias 
tolerantes a un grado moderado de polución, como Baetidae, Aeshnidae y Naididae, 
lo que evidencia que las estaciones río arriba se encuentran en un estado 
ligeramente mejor.

Las estaciones del río Frío se caracterizaron por poseer una fauna de 
macroinvertebrados dominada por anfípodos de la familia Hyalellidae y gasterópodos 
de la familia Physidae, que alcanzaron el 60 a 80% de la abundancia, mientras que
los insectos fueron poco representativos en este río. Si bien los insectos suelen
representar gran parte de los macroinvertebrados en los ríos tropicales de alta 
montaña (Dudgeon, 2008), no es infrecuente que otros grupos de macroinvertebrados
sean los organismos dominantes (Ward, 1994; Turcotte y Harper, 1982). La familia 
Hyalellidae suele ser un grupo frecuente en ambientes lénticos y lóticos de alta 
montaña (Jacobson y Marín, 2008) y se considera una familia resistente a la 
contaminación (Jacobsen y Encalada, 1998; Ríos-Touma *et al*., 2014). 

La baja abundancia de dípteros Chironomidae, una de las familias de macroinvertebrados
más frecuentes en aguas continentales, en las estaciones del río Frío es 
contrastante con estudios realizado en otros ríos de la sabana de Bogotá 
(Meneses-Campos *et al*., 2019) e inclusive en la parte alta del río Frío 
(Forero, 2017). En esos estudios, realizados en condiciones fisicoquímicas 
similares a las reportadas en las estaciones muestreadas, la presencia de 
Chironomidae fue mucho mayor, siendo una de los taxones dominante en las 
comunidades.

Al observar los índices de diversidad alfa de Shannon y Simpson (Fig 3B), se 
observa que las estaciones presentaron valores cercanos, sin que se viera una 
clara relación con el análisis de clúster de las variables fisicoquímicas, ni 
con el gradiente ambiental observado (Fig 2A y Fig 2B). Al parecer, la diversidad
alfa no es una variable que refleja claramente los cambios en el deterioro del 
agua.

El análisis de diversidad beta (Fig 3A) mostró que las comunidades de 
macroinvertebrados de ambos ríos fueron diferentes, con la excepción de la estación 
Fri5, que tuvo una composición más parecida a  la del río Neusa. La estación Fri5, 
ubicada en el municipio de Chía, tiene unas condiciones muy diferentes a las demás 
estaciones del río Frío. En esta estación, la comunidad se encuentra representada 
en gran parte por Chironomidae y por Hirudíneos, con una presencia muy reducida de 
anfípodos. Si bien, los índices de diversidad fueron más altos en esta estación en
comparación con los demás sitios del río Frío, el bajo número de familias e individuos 
por muestreo en Fri5 indica que esta estación no fue especialmente diversa ni rica
en taxones de invertebrados.


### Respuesta funcional

Cuando se habla de organización funcional de una comunidad, uno de los rasgos 
mejor estudiados de los macroinvertebrados es el de los grupos funcionales de 
alimentación (FFG), que se utilizan a menudo en el monitoreo ambiental de la 
calidad del agua (Tomanova *et al*., 2008; Pinilla, 2010; Vera-Sánchez y Pinilla,
2020). En el presente trabajo no fue posible establecer correlaciones significativas 
entre las variables medioambientales y la mayoría de las categorías de los rasgos 
funcionales (Anexo 4), pero vale la pena mencionar algunas tendencias observadas 
en los FFG de las comunidades trabajadas. Como se vio en el análisis RLQ (Fig 4B),
los organismos colectores-recolectores no tuvieron una relación fuerte con ninguna
de las variables medioambientales, aunque fueron muy abundantes en todas las estaciones
(Chironomidae en el río Neusa y Hyalellidae en el río Frío). Los organismos 
colectores-recolectores se han relacionado con sitios contaminados en ríos tropicales
de tierras bajas, así como en ríos de zonas templadas (Usseglio-Polatera y 
Beisel, 2002; Lecerf *et al*., 2006, Tomanova *et al*., 2008). Pese a esto, en ríos
tropicales de alta montaña se consideran organismos bastante frecuentes, que 
representan usualmente una gran parte de las comunidades de macroinvertebrados
(Dudgeon, 2008), por lo cual no es extraño encontrarlos a lo largo de todo el 
gradiente ambiental.

Existe una tendencia en los ríos tropicales de alta montaña a una alta diversidad
de los organismos depredadores (Dudgeon, 2008), lo cual también se observó en 
los ríos Frío y Neusa, en donde las familias depredadoras representaron
aproximadamente un 37% del total de familias encontradas. Los organismos
trituradores fueron en general poco abundantes y poco diversos en la mayoría de 
las estaciones y mostraron un patrón ya observado en las aguas tropicales en 
general (Dudgeon, 2008). Sin embargo, en la estación Fri4 fueron un poco más 
frecuentes, posiblemente debido a la hojarasca producida por la vegetación aledaña 
al río (principalmente eucaliptos), muy abundante en esta estación.

Debido a la falta de información a nivel taxonómico y ecológico de los 
macroinvertebrados de las aguas subtropicales, el método ‘fuzzy coding’ ha 
permitido el desarrollo de herramientas de monitoreo a nivel de familia que 
permiten evaluar los patrones de cambio de la diversidad funcional a lo largo 
de gradientes de contaminación ambiental (Usseglio-Polatera *et al*., 2000; 
Tomanova *et al*., 2008). Este nivel de resolución taxonómica ha demostrado ser 
una buena alternativa al uso de las especies en estudios de ecología tropical 
(Melo, 2005), pero la alta diversidad ecológica y fisiológica que presentan 
familias como Chironomidae pueden limitar este enfoque taxonómico grueso en 
los estudios de diversidad funcional.

Nuevos estudios a nivel de género en las comunidades de macroinvertebrados de 
los ríos de la Sabana de Bogotá podrían permitir el desarrollo de alternativas 
al ‘fuzzy coding’, como la presentada por Colzani *et al*. (2013) basada en la
diversidad funcional, que permite el cálculo de otro tipo de índices funcionales
como la riqueza, la igualdad o la divergencia funcionales. Estos índices pueden 
integrarse fácilmente en índices multimétricos de biomonitoreo (Saito *et al*., 2014).


## Conclusiones

En los ríos Frío y Neusa fue posible identificar cuatro zonas con diferencias en
sus características fisicoquímicas. El curso alto del río Neusa presenta aguas
bien oxigenadas, claras y con una alta conductividad; el curso bajo del río Neusa
también presenta una buena oxigenación, aguas un poco más turbias y una baja
conductividad; las aguas del río Frío a la altura del municipio de Cajicá presenta
aguas con una baja concentración de oxígeno, turbias y con una conductividad 
relativamente baja; y el cauce del río Frío en el área urbana de Chía presenta
concentraciones muy bajas de oxígeno, una alta conductividad y un pH ácido.

Las estructura de las comunidades muestra que los macroinvertebrados variaron 
entre los dos ríos, con cambios en su fauna dominante y en las familias presentes.
En el río Neusa no hay mayores diferencias entre las comunidades río arriba y 
río abajo de la represa. El río Frío, por su parte, sí presenta diferencias entre 
las estaciones ubicadas en Cajicá y la estación que se encuentra en el municipio 
de Chía, dado que en esta última hay una muy baja riqueza de familias.

Es posible relacionar los rasgos funcionales de las comunidades de macroinvertebrados
con el gradiente ambiental. Sin embargo, estas relaciones son débiles, puesto que 
en general no presentan una correlación notable con las variables medioambientales
medidas. El presente trabajo representa una primera aproximación hacia el estudio 
de la diversidad funcional en los ríos de la Sabana de Bogotá, y muestra que es
necesario abordar nuevos estudios a nivel de género que contribuyan a profundizar 
en el tema.

## Agradecimientos

El autor agradece al Centro de Estudios en Hidrobiología de la Universidad Manuela 
Beltrán (CEH-UMB) y en especial al profesor Ciromar Lemus, quien facilitó el acceso
a las muestras de macroinvertebrados para su análisis y aportó la información de 
las variables fisicoquímicas medidas in situ. También se agradece a la Universidad
Nacional de Colombia, a la Facultad de Ciencias y al Departamento de Biología 
por el apoyo logístico para el uso del estereoscopio empleado para la identificación 
de los especímenes.

\newpage

## Bibliografía

Charvet, S., Kosmala, A., & Statzner, B. (1998). Biomonitoring through biological traits of
benthic macroinvertebrates: Perspectives for a general tool in stream management.
Archiv Fuer Hydrobiologie, 142(4), 415-432.  

Chevenet, F., Dolédec, S. and Chessel, D. (1994) A fuzzy coding approach for the analysis 
of long-term ecological data. Freshwater Biology, 31, 295–309.

Colzani, E., Siqueira, T., Suriano, M. T., & Roque, F. O. (2013). Responses of 
Aquatic Insect Functional Diversity to Landscape Changes in Atlantic Forest.
Biotropica, 45(3), 343–350. https://doi.org/10.1111/btp.12022

Cummins, K. W., Merritt, R. W., & Andrade, P. C. (2005). The use of invertebrate
functional groups to characterize ecosystem attributes in selected streams and rivers in
south Brazil. Studies on Neotropical Fauna and Environment, 40(1), 69-89.  

Ding, N., Yang, W., Zhou, Y., González-Bergonzoni, I., Zhang, J., Chen, K., Vidal, N.,
Jeppesen, E., Liu, Z., & Wang, B. (2017). Different responses of functional traits and
diversity of stream macroinvertebrates to environmental and spatial factors in the
Xishuangbanna watershed of the upper Mekong River Basin, China. Science of The Total
Environment, 574, 288-299.  

Doledec, S., Chessel, D., ter Braak, C.J.F. and Champely, S. (1996) Matching species 
traits to environmental variables: a new three-table ordination method. Environmental
and Ecological Statistics, 3, 143–166.

Dolédec, S., Phillips, N., Scarsbrook, M., Riley, R. H., & Townsend, C. R. (2006).
Comparison of structural and functional approaches to determining landuse effects on
grassland stream invertebrate communities. Journal of the North American Benthological
Society, 25(1), 44-60.  

Domínguez, E., & Fernández, H (eds). (2019), Macroinvertebrados bentónicos
sudamericanos. Sistemática y biología. Fundación Miguel Lillo, Tucumán, Argentina.
Fossati, O., Wasson, J.-G., Héry, C., Salinas, G., & Marín, R. (2001). Impact of sediment
releases on water chemistry and macroinvertebrate communities in clear water Andean
streams (Bolivia). Archiv Für Hydrobiologie, 151(1), 33-50. 

Dray S, Dufour A (2007). “The ade4 Package: Implementing the Duality Diagram for Ecologists.” 
Journal of Statistical Software_, *22*(4), 1-20. doi: 10.18637/jss.v022.i04 (URL:
https://doi.org/10.18637/jss.v022.i04).

Dray, S. and Legendre, P. (2008) Testing the species traits-environment relationships: 
the fourth-corner problem revisited. Ecology, 89, 3400–3412.

Dudgeon, D. (2011). Tropical Stream Ecology. Elsevier. USA

Fierro, P., Valdovinos, C., Vargas-Chacoff, L., Bertrán, C., & Arismendi, I. (2017).
Macroinvertebrates and Fishes as Bioindicators of Stream Water Pollution. Water Quality. 
https://doi.org/10.5772/65084  

Forero, J. (2017). Macroinvertebrados bentónicos y su relación con la calidad
del agua en la cuenca alta de del Río Frío (Tabio, Cundinamarca). Bogota-
Colombia: PONTIFICIA UNIVERSIDAD JAVERIANA. Recup eradoel Julio de, 31.

Gayraud, S., Statzner, B., Bady, P., Haybachp, A., Schöll, F., Usseglio‐Polatera, P., &
Bacchi, M. (2003). Invertebrate traits for the biomonitoring of large European rivers: An
initial assessment of alternative metrics. Freshwater Biology, 48(11), 2045-2064. 

Jacobsen, D., & Encalada, A. (1998). The macroinvertebrate fauna of Ecuadorian
highland streams in the wet and dry season. Fundamental and Applied Limnology /
Archiv Für Hydrobiologie, 142, 53–70.

Jacobsen, D., & Marín, R. (2008). Bolivian Altiplano streams with low richness of
macroinvertebrates and large diel fluctuations in temperature and dissolved oxygen.
Aquatic Ecology, 42, 643–656. https://doi.org/10.1007/s10452-007-9127-x

Lemus-Portillo, C., Echavarria-Pedraza, M. C., Rojas, J. E., Alvarez-Diaz, J. E.,
León-Pardo, K. J., Aguilar-Orjuela, S., & Maldonado, J. F. (2020). Estado de conservación
y distribución del pez de agua dulce Capitán de la Sabana Eremophilus mutisii 
en Cundinamarca, Colombia. Actualidades Biológicas, 42(112).  

Lecerf A, Usseglio-Polatera P, Charcosset JY, Lambrigot D, Bracht B, Chauvet E. 2006. 
Assessment of functional integrity of eutrophic streams using litter breakdown and 
benthic macroinvertebrates. Archiv fur Hydrobiologie 165: 105–126.

Meneses-Campo, Y., Castro-Rebolledo, M. I., & Jaramillo-Londoño, A. M. (2019).
Comparación de la calidad del agua en dos ríos altoandinos mediante el uso de los 
índices bmwp/col. y ABI. Acta Biológica Colombiana, 24(2), 299–310.

Melo AS. 2005. Effects of taxonomic and numeric resolution on the ability to 
detect ecological patterns at a local scale using stream
macroinvertebrates. Archiv fur Hydrobiologie 164: 309–323.

Metcalfe, J. L. (1989). Biological water quality assessment of running waters 
based on macroinvertebrate communities: History and present status in Europe. 
Environmental Pollution, 60(1), 101–139. https://doi.org/10.1016/0269-7491(89)90223-6  

Motta Díaz, A. J., Longo, M., & Aranguren-Riaño, N. (2020). Variación temporal de la
diversidad taxonómica y rasgos funcionales de los macroinvertebrados acuáticos en ríos
temporales en la isla de Providencia, Colombia. Actualidades Biológicas, 39(107), 82-100.  

Pinilla, G. (2010). An index of limnological conditions for urban wetlands of 
Bogotá city, Colombia. Ecological Indicators, 10(4), 848–856. https://doi.org/10.1016/j.ecolind.2010.01.006  

R Core Team (2020). R: A language and environment for statistical computing.
R Foundation for Statistical Computing, Vienna, Austria. URL https://www.R-project.org/.

Ríos-Touma, B., Acosta, R., & Prat, N. (2014). The Andean Biotic Index (ABI):
Revised tolerance to pollution values for macroinvertebrate families and index 
performance evaluation. Revista de Biología Tropical, 62, 249–273.

Saito, V. S., Siqueira, T., & Fonseca-Gessner, A. A. (2015). Should phylogenetic 
and functional diversity metrics compose macroinvertebrate multimetric indices 
for stream biomonitoring?. Hydrobiologia, 745(1), 167-179.

Statzner, B., Bady, P., Dolédec, S., & Schöll, F. (2005). Invertebrate traits for the
biomonitoring of large European rivers: An initial assessment of trait patterns in least
impacted river reaches. Freshwater Biology, 50(12), 2136-2161.  

Tomanova, S., Moya, N., & Oberdorff, T. (2008). Using macroinvertebrate biological traits
for assessing biotic integrity of neotropical streams. River Research and Applications,
24(9), 1230-1239. https://doi.org/10.1002/rra.1148.  

Toro, J. A. R., Ramirez, N. J. A., Lopez, J. P. S., Atilano, E. H., & Macías, F. de J. V. (2020).
Energía calórica, biomasa y estructura de los macroinvertebrados acuáticos en la reserva
La Nitrera, Concordia, Antioquia, Colombia. Acta Biológica Colombiana, 25(1), 29-36.  

Torres-Zambrano, N. N., & Torres-Zambrano, D. R. (2016). Macroinvertebrados acuáticos
de la quebrada Los Alisos, Firavitoba—Boyacá. Intropica, 11, 47-56

Turcotte, P., and Harper, P.P. (1982). Drift patterns in a high Andean stream.
Hydrobiologia 89, 141–151.

Usseglio‐Polatera, P. (1994). Theoretical habitat templets, species traits, and
species richness: Aquatic insects in the Upper Rhône River and its floodplain.
Freshwater Biology, 31(3), 417–437. https://doi.org/10.1111/j.1365-2427.1994.tb01749.x  

Usseglio-Polatera P, Beisel JN. (2002). Longitudinal changes in macroinvertebrate
assemblages in the Meuse river: anthropogenic effects versus
natural change. River Research and Applications 18: 197–211.

Usseglio-Polatera P, Bournaud M, Richoux P, Tachet H. (2000). 
Biomonitoring through biological traits of benthic macroinvertebrates: how to use

Sánchez, D. A. V., & Pinilla, G. A. (2020). Aproximación preliminar a un índice
multimétrico de macroinvertebrados (IMARBO) para evaluar el estado ecológico de
ríos de las cuencas alta y media del río Chicamocha en Boyacá, Colombia. 
Gestión y Ambiente, 23(1), 3-4.

Ward, J.V. (1994). Ecology of alpine streams. Freshwater Biology 32, 277–294.


## Anexos

\newpage
\blandscape

```{r rasgos }
rasgos_func <- read.csv("../Data/rlq/QTable.csv", check.names = FALSE)
rasgos <-  c("A) Tipo Alimento", 
             "B) Habitos Alimenticios", 
             "C) Respiracion",
             "D) Forma Corporal", 
             "E) Movilidad",
             "F) Tamaño Maximo")


table_pdf <- expression(
rasgos_func %>%
  kbl(booktabs = TRUE, escape = FALSE, caption = "
        Anexo 1. Clasificación de los rasgos funcionales  basados en 
        la metodologia del Fuzzy Code para las familias de 
        macroinvertebrados presentes en los ríos de la Sabana 
        de Bogotá.") %>%
     kable_styling(latex_options="scale_down") %>%
     add_header_above(c("",
                      "Tipo Alimento" = 6, 
                      "Habitos Alimenticios" = 5, 
                      "Respiracion" = 4,
                      "Forma Corporal" = 4, 
                      "Movilidad" = 6,
                      "Tamaño Maximo" = 5))   
)

table_word <- expression(
    NULL
)

parse_table(latex = table_pdf, docx = table_word)

```
\elandscape

\newpage

### Anexo 2

El análisis univariado de las variables fisicoquimicas e hidrologicas. En las 
figuras se observan los diagramas de caja que corresponde a un análisis descriptivo
de las variables. Los gráficos cuantil-cuantil indican que tan bien se ajustan 
las variables a una distribución normal.  

```{r anexos_eda, message=FALSE, warning=FALSE, cache=FALSE,include = TRUE, echo = FALSE, fig.height= 9, fig.width= 9, fig.align='center'}

box_plots <-  univariate_graphical_eda(data = complete, type_plot = 'boxplot')

  box_plots$OxDisuelto + 
  box_plots$Turbidez +
  box_plots$Conductividad + 
  box_plots$Temperatura +
  box_plots$pH +
  box_plots$Profundidad + 
  box_plots$Velocidad +
  plot_layout(ncol = 3, byrow = FALSE ) 
  
```



### Anexo 3

Resultados del análisis de varianza multivariado de los grupos generados por el 
análisis de cluster. El análisis post hoc incluyo multiples tests de hotelling 
entre los pares de grupos. 


```{r manova,  message=FALSE, warning=FALSE}
results_manova <- list(
Global =  make_manova(data = complete, global = TRUE),
NeuA_NeuB  = make_manova(data = complete, est1 = "NeusaA", est2 = "NeusaB"),
NeuA_FrioA =  make_manova(data = complete, est1 = "NeusaA", est2 = "FrioA"),
NeuA_FrioB =  make_manova(data = complete, est1 = "NeusaA", est2 = "FrioB"),
NeuB_FrioA =  make_manova(data = complete, est1 = "NeusaB", est2 = "FrioA"),
NeuB_FrioB =  make_manova(data = complete, est1 = "NeusaB", est2 = "FrioB"),
FrioA_FrioB =  make_manova(data = complete, est1 = "FrioA", est2 = "FrioB")
)

 for (i in 1:6) { 
     
     cat(" ")  
     print(names(results_manova[i]))
     print(summary(results_manova[[i]]))
     cat(" ")
     
 }

```


```{r fourthcorner1, message= FALSE, warning= FALSE, include= FALSE, cache= FALSE}

fourth_corner <- make_rlq(RLQ$R_table, RLQ$L_table, RLQ$Q_table,
                          fourthcorner = TRUE, parameters = parameters)
fourth_corner$envir

f4c_traits <- as.data.frame(print(fourth_corner$traits), 
                            stringsAsFactors = FALSE, 
                            row.names = NULL, 
                            optional = TRUE) %>%
              subset(select= -Stat) %>%
              subset(select= -Alter) 
 
f4c_traits <- f4c_traits %>% 
              subset(grepl("AxcR1", .$Test)) %>%
              remove_rownames() %>%
              column_to_rownames("Test")

f4c_envir <- as.data.frame(print(fourth_corner$envir), 
                           stringsAsFactors = FALSE,
                           row.names = NULL, 
                           optional = TRUE) %>%
             subset(select= -Stat) %>%
             subset(select= -Alter) 
 
f4c_envir <- f4c_envir %>% 
  subset(grepl("AxcQ1", .$Test)) %>%
  remove_rownames() %>%
  column_to_rownames("Test")



```

```{r fourthcorner2, message= FALSE, warning= FALSE }
res_4c <- rbind(f4c_traits, f4c_envir)



table_pdf <- expression(
 res_4c %>%
      kbl(booktabs = TRUE, escape = FALSE,
          caption = "Anexo 4: Resultados del Analisis Fourthcorner de las correlaciones
                     (Pearson) entre el primer eje del plano factorial RLQ y los
                      rasgos funcionales y las variables ambientales.
                      Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1 ") %>%
      kableExtra::group_rows("Traits", 1, 30) %>%
      kableExtra::group_rows("Enviromental", 31, 35)  
)

table_word <- expression(
    NULL
)

parse_table(latex = table_pdf, docx = table_word)

```




